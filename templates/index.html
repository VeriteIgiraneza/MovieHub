<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>MovieHub - Advanced Search</title>
   <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
   <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
   <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='MovieHubImage.jpg') }}">
</head>
<body>
   <nav class="navbar">
       <div class="nav-content">
           <div class="nav-brand">
               <i class="fas fa-film"></i>
               <h1>MovieHub</h1>
           </div>
           <div class="nav-links">
               <a href="/" class="{% if request.endpoint == 'index' %}active{% endif %}">
                    <i class="fas fa-home"></i>
                </a>
                <button onclick="openModal()" class="nav-link btn-add">
                    <i class="fas fa-plus"></i> Add Movie
                </button>
           </div>
       </div>
   </nav>

   <main class="container">
       {% if error %}
           <div class="alert alert-error" data-context="{{ error_context }}" id="error-message">
               {{ error }}
           </div>
       {% endif %}
       <section class="search-section">
           <div class="search-tabs">
               <button class="tab-btn active" onclick="showSearch('text')">Text Search</button>
               <button class="tab-btn" onclick="showSearch('filter')">Filter Movies</button>
           </div>

           <form id="text-search" class="search-form" action="/search" method="GET">
               <div class="search-bar">
                   <i class="fas fa-search"></i>
                   <input type="text" name="query" placeholder="Search movies, directors, or stars..." required>
                   <select name="search_type" class="search-type">
                       <option value="all">All</option>
                       <option value="movie">Movies</option>
                       <option value="director">Directors</option>
                       <option value="star">Stars</option>
                   </select>
               </div>
               <button type="submit" class="search-button">
                   <i class="fas fa-search"></i>
                   Search
               </button>
           </form>

           <form id="filter-search" class="search-form hidden" action="/filter" method="GET">
               <div class="filters">
                   <div class="filter-group">
                       <label>
                           <i class="fas fa-star"></i>
                           Rating Range
                       </label>
                       <div class="rating-inputs">
                           <input type="number" name="min_rating" step="0.1" min="0" max="10" placeholder="Min">
                           <span>to</span>
                           <input type="number" name="max_rating" step="0.1" min="0" max="10" placeholder="Max">
                       </div>
                   </div>

                   <div class="filter-group">
                       <label>
                           <i class="fas fa-tags"></i>
                           Genre
                       </label>
                       <select name="genre" class="genre-select">
                           <option value="">All Genres</option>
                           {% if genres %}
                               {% for genre in genres %}
                                   <option value="{{ genre[0] }}">{{ genre[1] }}</option>
                               {% endfor %}
                           {% endif %}
                       </select>
                   </div>

                   <button type="submit" class="search-button">
                       <i class="fas fa-filter"></i>
                       Apply Filters
                   </button>
               </div>
           </form>
       </section>

       <section class="results-section">
           <div class="results-header">
               <h2>
                   {% if filter_applied %}
                       {% if selected_genre %}
                           Showing {{ genre_name }} Movies
                       {% elif rating_range %}
                           Showing Movies with Rating {{ rating_range }}
                       {% else %}
                           All Movies
                       {% endif %}
                   {% else %}
                       Movie Results
                   {% endif %}
               </h2>
               <div class="sort-control">
                   <label><i class="fas fa-sort"></i> Sort by:</label>
                   <select id="sort-select" onchange="updateSort(this.value)">
                       <option value="rating_desc">Rating (High to Low)</option>
                       <option value="rating_asc">Rating (Low to High)</option>
                       <option value="votes_desc">Most Votes</option>
                       <option value="name_asc">Name (A-Z)</option>
                   </select>
               </div>
           </div>

           <div class="movies-grid">
               {% if movies %}
                   {% for movie in movies %}
                   <article class="movie-card">
                       <div class="movie-header">
                           <h3>{{ movie[1] }}</h3>
                           <div class="rating">
                               <i class="fas fa-star"></i>
                               <span>{{ movie[2] if movie[2] else 'N/A' }}</span>
                           </div>
                       </div>

                       <div class="movie-details">
                           <p><i class="fas fa-clock"></i> {{ movie[3] if movie[3] else 'N/A' }}</p>
                           <p><i class="fas fa-film"></i> {{ movie[4] if movie[4] else 'N/A' }}</p>
                           <p><i class="fas fa-chart-line"></i> Metascore: {{ movie[5] if movie[5] else 'N/A' }}</p>

                           <div class="collapsible-content">
                               <p class="plot"><i class="fas fa-book"></i> {{ movie[6] if movie[6] else 'N/A' }}</p>
                               <p><i class="fas fa-video"></i> {{ movie[7] if movie[7] else 'N/A' }}</p>
                               <p><i class="fas fa-user"></i> {{ movie[8] if movie[8] else 'N/A' }}</p>
                               <p><i class="fas fa-poll"></i> {{ movie[9] if movie[9] else '0' }} votes</p>
                               <p><i class="fas fa-dollar-sign"></i> {{ movie[10] if movie[10] else 'N/A' }}</p>
                           </div>

                           <div class="card-actions">
                               <button class="btn-details" onclick="toggleDetails(this)">
                                   Show Details
                               </button>
                               <a href="{{ movie[11] }}" target="_blank" class="btn-link">
                                   <i class="fas fa-external-link-alt"></i>
                                   Learn More
                               </a>
                           </div>
                       </div>
                   </article>
                   {% endfor %}
               {% else %}
                   <div class="no-results">
                       <i class="fas fa-search"></i>
                       <p>No movies found matching your criteria!</p>
                   </div>
               {% endif %}
           </div>
       </section>
   </main>



   <div id="addMovieModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-plus-circle"></i> Add New Movie</h2>
            <button class="close-button" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

<!--        {% if error %}-->
<!--            <div class="alert alert-error">-->
<!--                {{ error }}-->
<!--            </div>-->
<!--        {% endif %}-->

        <form class="add-movie-form" action="{{ url_for('add_movie') }}" method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-film"></i> Title</label>
                    <input type="text" name="title" required placeholder="Movie title">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-star"></i> Rating</label>
                    <input type="number" name="rating" step="0.1" min="0" max="10" placeholder="0-10">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> Runtime</label>
                    <input type="text" name="runtime" placeholder="e.g., 120 min">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-chart-line"></i> Metascore</label>
                    <input type="number" name="metascore" min="0" max="100" placeholder="0-100">
                </div>
            </div>

            <div class="form-group">
                <label><i class="fas fa-book"></i> Plot</label>
                <textarea name="plot" rows="3" placeholder="Movie plot summary"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-video"></i> Directors</label>
                    <input type="text" name="directors" placeholder="Comma-separated directors">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Stars</label>
                    <input type="text" name="stars" placeholder="Comma-separated stars">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label><i class="fas fa-poll"></i> Votes</label>
                    <input type="number" name="votes" min="0" placeholder="Number of votes">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-dollar-sign"></i> Gross</label>
                    <input type="number" name="gross" step="0.01" min="0" placeholder="Box office earnings">
                </div>
            </div>

            <div class="form-group">
                <label><i class="fas fa-link"></i> Link</label>
                <input type="url" name="link" placeholder="Movie link (e.g., IMDb URL)">
            </div>

            <div class="form-group">
                <label><i class="fas fa-tags"></i> Genres</label>
                <div class="genre-checkboxes">
                    {% for genre in genres %}
                    <label class="checkbox-label">
                        <input type="checkbox" name="genres" value="{{ genre[0] }}">
                        {{ genre[1] }}
                    </label>
                    {% endfor %}
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-submit">
                    <i class="fas fa-plus"></i> Add Movie
                </button>
                <button type="button" class="btn-cancel" onclick="closeModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </form>
    </div>
</div>



   <script>
    // Sort functionality
        function updateSort(value) {
            const currentUrl = new URL(window.location.href);
            currentUrl.searchParams.set('sort', value);
            window.location.href = currentUrl.toString();
        }

        // Movie details toggle
        function toggleDetails(button) {
            const card = button.closest('.movie-card');
            const content = card.querySelector('.collapsible-content');
            const isExpanded = content.classList.toggle('expanded');
            button.textContent = isExpanded ? 'Hide Details' : 'Show Details';
        }

        // Search type toggle
        function showSearch(type) {
            const textSearch = document.getElementById('text-search');
            const filterSearch = document.getElementById('filter-search');
            const buttons = document.querySelectorAll('.tab-btn');

            if (type === 'text') {
                textSearch.classList.remove('hidden');
                filterSearch.classList.add('hidden');
                buttons[0].classList.add('active');
                buttons[1].classList.remove('active');
            } else {
                textSearch.classList.add('hidden');
                filterSearch.classList.remove('hidden');
                buttons[0].classList.remove('active');
                buttons[1].classList.add('active');
            }
        }

        // Modal functions
        function openModal() {
            const modal = document.getElementById('addMovieModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal() {
            const modal = document.getElementById('addMovieModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('addMovieModal');
                if (event.target === modal) {
                    closeModal();
                }
            };

            // Close modal on escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeModal();
                }
            });

            // Only show modal for add-movie errors
            const errorMessage = document.getElementById('error-message');
            const isAddMovieError = errorMessage && errorMessage.dataset.context === 'add-movie';
            const hasFormData = document.querySelector('[name="form_data"]');
            if (isAddMovieError || hasFormData) {
                openModal();
            } else {
                closeModal();
            }
        });
        if (window.location.pathname === '/') {
            closeModal();
        }
   </script>
</body>
</html>